{% extends 'teacher/teacher_base.html' %}

{% block content %}
<div class="content-container">
  <h2>Edit Results</h2>

  {% if error %}
    <div class="error">{{ error }}</div>
  {% endif %}

  <form method="POST" class="filter-form">
    <div class="form-group">
      <label for="subject_id">Subject:</label>
      <select name="subject_id" required>
        <option value="">Select Subject</option>
        {% for a in assignments %}
          <option value="{{ a.subject_id }}" {% if a.subject_id == selected_subject_id %}selected{% endif %}>
            {{ a.subject_name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="form-group">
      <label for="class_id">Class:</label>
      <select name="class_id" required>
        <option value="">Select Class</option>
        {% for a in assignments %}
          <option value="{{ a.class_id }}" {% if a.class_id == selected_class_id %}selected{% endif %}>
            {{ a.class_name }} {{ a.stream }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="form-group">
      <label for="exam_id">Exam:</label>
      <select name="exam_id" required>
        <option value="">Select Exam</option>
        {% for exam in exams %}
          <option value="{{ exam.id }}" {% if exam.id == selected_exam_id %}selected{% endif %}>
            {{ exam.name }} - {{ exam.term }} {{ exam.year }}
          </option>
        {% endfor %}
      </select>
    </div>

    <button type="submit">View Results</button>
  </form>

  {% if results %}
    <form method="POST">
      <input type="hidden" name="subject_id" value="{{ selected_subject_id }}">
      <input type="hidden" name="class_id" value="{{ selected_class_id }}">
      <input type="hidden" name="exam_id" value="{{ selected_exam_id }}">
      <input type="hidden" name="update" value="1">

      <table class="styled-table">
        <thead>
          <tr>
            <th>Student</th>
            <th>Score</th>
            <th>Remarks</th>
          </tr>
        </thead>
        <tbody>
          {% for result in results %}
            <tr>
              <td>{{ result.student_name }}</td>
              <td>
                <input type="hidden" name="student_id" value="{{ result.student_id }}">
                <input type="number" name="score_{{ result.student_id }}" value="{{ result.score }}" required>
              </td>
              <td>
                <input type="text" name="remarks_{{ result.student_id }}" value="{{ result.remarks }}">
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <button type="submit">Save Changes</button>
    </form>
  {% endif %}
</div>
{% endblock %}
